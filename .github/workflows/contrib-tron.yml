name: Update Profile README with Tron Game Screenshot

on:
  schedule:
    # Update twice daily to show game activity
    - cron: '0 8,20 * * *'
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install Puppeteer
      run: |
        npm init -y
        npm install puppeteer

    - name: Capture Tron Game Screenshot
      run: |
        cat > capture.js << 'EOF'
        const puppeteer = require('puppeteer');
        const fs = require('fs');

        (async () => {
          const browser = await puppeteer.launch({
            headless: 'new',
            args: ['--no-sandbox', '--disable-setuid-sandbox']
          });
          
          const page = await browser.newPage();
          await page.setViewport({ width: 800, height: 400 });
          
          // Navigate to your Tron game
          await page.goto('https://markpython86.github.io/markpython86-tron-github/', {
            waitUntil: 'networkidle0'
          });
          
          // Wait for game to load and start
          await page.waitForTimeout(3000);
          
          // Take screenshot
          await page.screenshot({
            path: 'tron-game.png',
            clip: { x: 0, y: 0, width: 800, height: 400 }
          });
          
          await browser.close();
          console.log('Screenshot captured!');
        })();
        EOF
        
        node capture.js

    - name: Update README
      run: |
        # Get current timestamp
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M UTC')
        
        cat > README.md << EOF
        # Hi there! 👋

        ## 🏍️ Contrib Tron - AI Light Cycles Racing Through My GitHub Contributions

        <div align="center">
          <a href="https://markpython86.github.io/markpython86-tron-github/">
            <img src="./tron-game.png" 
                 alt="Tron GitHub Game - AI Light Cycles Racing" 
                 width="800"/>
          </a>
          <br>
          <em>🎮 Live auto-playing Tron game using my GitHub contribution data</em>
          <br>
          <strong><a href="https://markpython86.github.io/markpython86-tron-github/">🏍️ Click to Play Interactive Version</a></strong>
          <br>
          <small>Last updated: $TIMESTAMP</small>
        </div>

        ---

        ### 🚀 About This Game

        This auto-playing Tron Light Cycles game transforms my GitHub contribution grid into a racing arena where AI motorcycles compete using advanced pathfinding algorithms.

        **🎯 Game Features:**
        - 🧠 **Smart AI**: Neural network-inspired decision making
        - 📊 **Real Data**: Uses actual GitHub contribution patterns  
        - ⚡ **Auto-Playing**: Continuous loop perfect for profiles
        - 🎨 **Visual Effects**: Neon trails and particle systems
        - 🏆 **Scoring**: Survival time + active cycles + trail complexity

        ### 🛠️ Create Your Own Tron Game

        \`\`\`bash
        git clone https://github.com/markpython86/tron-github.git
        cd tron-github
        npm install && npm run build
        node dist/cli.js init --user YOUR_USERNAME
        \`\`\`

        **⭐ [Star the tron-github project](https://github.com/markpython86/tron-github)** to create your own!

        ---

        <div align="center">
          <img src="https://github-readme-stats.vercel.app/api?username=markpython86&show_icons=true&theme=dark" alt="GitHub Stats"/>
        </div>
        EOF

    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md tron-game.png
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "🏍️ Update Tron game screenshot - $(date)"
          git push
        fi